<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Admin Panel | Infocap Securities</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: #f4f6f9;
            font-family: Poppins, sans-serif;
            padding: 30px;
        }
        
        h3 {
            color: #0073e6;
            font-weight: 600;
        }
        
        .card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>

<body>
    <div class="container">
        <h3>Admin Panel â€” Risk Manager</h3>
        <p class="text-muted">Change trader quantities below ðŸ‘‡</p>

        <div class="card p-3">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Email</th>
                        <th>Role</th>
                        <th>Default Qty</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for u in users %} {% if u.role.lower() == "trader" %}
                    <tr>
                        <td>{{ u.email }}</td>
                        <td>{{ u.role }}</td>
                        <td><input type="number" id="qty-{{ loop.index }}" value="{{ u.default_quantity or 75 }}" min="1" class="form-control form-control-sm" style="width:100px;"></td>
                        <td><button class="btn btn-primary btn-sm" onclick="updateQuantity('{{ u.email }}', document.getElementById('qty-{{ loop.index }}').value)">
  Update
</button>
                        </td>
                    </tr>
                    {% endif %} {% endfor %}
                </tbody>
            </table>
        </div>

        <p id="msg" class="mt-3 text-center fw-semibold"></p>
    </div>

    <script>
        async function updateQuantity(email, qty) {
            const res = await fetch("/update_quantity", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    email,
                    qty
                })
            });
            const data = await res.json();
            document.getElementById("msg").innerText = data.message;
            document.getElementById("msg").className = "text-success";
        }
    </script>

</body>

</html>